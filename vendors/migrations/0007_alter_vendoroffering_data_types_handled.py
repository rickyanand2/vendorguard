# vendors/migrations/0007_alter_vendoroffering_data_types_handled.py

# Generated by Django 5.2.3 on 2025-07-29 23:59

from django.contrib.postgres.fields import ArrayField
from django.db import migrations, models


def clean_array_field(apps, schema_editor):
    """Fixes empty string values in data_types_handled and sets them to empty lists.
    """
    VendorOffering = apps.get_model("vendors", "VendorOffering")
    VendorOffering.objects.filter(data_types_handled="").update(data_types_handled=[])


class Migration(migrations.Migration):
    """Migration to clean old data and update the data_types_handled ArrayField.
    """

    dependencies = [
        ("vendors", "0006_rename_risk_score_vendoroffering_latest_risk_score_and_more"),
    ]

    operations = [
        migrations.RunPython(clean_array_field),
        migrations.AlterField(
            model_name="vendoroffering",
            name="data_types_handled",
            field=ArrayField(
                base_field=models.CharField(
                    choices=[
                        ("pii", "Personally Identifiable Information"),
                        ("phi", "Protected Health Information"),
                        ("pci", "Payment Card Information"),
                        ("financial", "Financial Records"),
                        ("business", "General Business Data"),
                        ("credentials", "Credentials / Passwords"),
                    ],
                    max_length=50,
                ),
                blank=True,
                default=list,
                size=None,
            ),
        ),
    ]
